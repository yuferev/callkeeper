# Передача вебхуков из личного кабинета CallTracking

- [Параметры, передаваемые в вебхуках CallKeeper](#Параметры-вебхуков-CallKeeper)
- [Параметры, передаваемые в вебхуках CallTracking](#Параметры-вебхуков-CallTracking)

## Настройка

Вы можете настроить отправку вебхуков по определенным событиям.
Для этого в личном кабинете ckct перейдите в раздел «Вебхуки».
В верхнем меню выберите сервис, информацию по звонкам которого вы хотите отправлять при помощи вебхуков.

![Рис.29](integrations_webhook_ct_new.png)

Здесь будут отображаться все настроенные вебхуки.

Для добавления нового вебхука нажмите «+ Адрес».

![Рис.30](integrations_webhook_ct_add.png)

Заполните поля в открывшейся вкладке.

## Описание полей

**«Хост, порт и протокол»** - хост - доменное имя сервера или его IP, порт - дефолтный http-порт - 80; в некоторых случаях, если прием данных настроен на другой порт, указывается через двоеточие после домена, протокол - http/https.

![Рис.31](webhook_host_protocol.png)

**«Путь»** - все, что идет в строке до знака вопроса (если его нет, то до конца строки).

![Рис.32](webhook_path.png)

**«Параметры запроса»** (имя, значение) - параметры, идущие после знака вопроса.
Вы можете дать свое название (нужное для получения информации на стороне клиента), которое будет соответствовать нашим предустановленным параметрам в звонках. Их список вы можете увидеть, щелкнув по полю "Значение". 
В поле "Имя" задайте нужное название для ключа, в поле "Значение" выберите соответствие нашему параметру.

![Рис.33](webhook_query_names.png)

**HTTP метод** - get - все параметры передаются в самой строке; post - данные не видно явно из строки, передаются в теле запроса.

**«Тип события»** - начало или завершение звонка. Определяет, в какой момент будет отправляться вебхук - когда соединение будет установлено или после завершения звонка. Учтите, что при отправке вебхука а начале звонка мы не сможем передать некоторые данные (например, duration - длительность звонка). 

**«Content type»** - специальный http-заголовок, который определяет тип содержимого тела запроса.

Нажмите кнопку «Добавить».

Все созданные пути для вебхуков сохранятся во разделе «Интеграции».

Вы можете удалить вебхуки, нажав на значок мусорного ведра или отредактировать созданные вебхуки, нажав на кнопку с карандашом.

## Передаваемые параметры
### Параметры вебхуков CallKeeper

-  **id** — id звонка в системе CallKeeper
-  **visit_info** — массив utm меток по звонку
-  **current** — массив utm-меток по текущему визиту  
-  **first** — массив utm меток по первому визиту  
-  **session pgs** — количество просмотренных страниц (до совершения звонка)  
-  **cpg** — страница откуда был совершен звонок  
-  **udata vst** — порядковый номер визита  
-  **uag** — данные User Agent  
-  **status_code** — код статуса звонка менеджеру SIP  
-  **status_reason** — сообщение о статусе звонка менеджеру  
-  **status2_code** — код статуса звонка клиенту SIP  
-  **status2_reason** — сообщение о статусе звонка клиенту  
-  **ip** — ip адрес клиента  
-  **country** — код страны  
-  **city** — название города  
-  **region** — название региона  
-  **district** — название округа  
-  **site** — сайт  
-  **ga_clientid** — Google Analytics ID  
-  **phone1** — номер тел менеджера [добавочный]  
-  **phone2** - номер тел клиента  
-  **widget_hash** — хеш виджета callkeeper date— дата звонка по UTC  
-  **duration_sec** — длительность звонка в секундах  
-  **a_type: 0** - тип соединения, который предпочел менеджер (;;;)  
-  **asr_attempts: 0** - количество попыток голосового smartcall  
-  **attempt: 1** - номер попытки звонка  
-  **date: "2018-12-04 12:14:54"** - дата и время звонка  
-  **date_timestamp: 1543925694** - дата и время звонка в формате timestamp  
-  **duration_min: "0"** - длительность звонка в минутах (округленная длительность в секундах)  
-  **event_source: "widget"** - тип инструмента, с которого был заказан звонок (28 вариантов)  
-  **hook_event: "Call is over"** (после завершения звонка) - “ Call is processing” (перед звонком)  
-  **order_date: "2018-12-04 12:14:54"** - дата и время заказа звонка  
-  **playback_tick: 0** - количество проговариваний ivr в течение звонка  
-  **record_url: ""** - ссылка на запись разговора  
-  **roistat_visit: null** - (если включена интеграция с ройстат) - идентификатор клиента в системе ройстат  
-  **tags: " "** - тэги (клиенты сами тэгируют звонки)  
-  **ga_clid:** - id клиента в ga  
-  **widget_name: "custom css"** - название виджета  
-  **ya_clientid: null** - id клиента в яндекс-метрике (по умолчанию собирается у всех)  
-  **uip - user ip** - ip клиента

### Параметры вебхуков CallTracking

- **record_url** - ссылка на запись разговора
- **ip** - ip адрес клиента
- **device** - устройство клиента
- **host** - хост
- **city** - город клиента
- **region** - регион клиента
- **country** - страна клиента
- **source_type** - тип источника
- **utm_source** - источник перехода
- **client_number** - номер клиента
- **calltracking_number** - подменный номер, участвовавший в данном звонке
- **manager_number** - номер менеджера
- **time_start** - время начала разговора
- **duration** - длительность разговора
- **dtmf_pressed** - кнопка, которую нажал оператор
- **call_status** - статус звонка
- **call_type** - тип звонка
- **company_name** - название кампании
- **office_name** - название офиса
- **user_id** - идентификатор пользователя
- **ga_clid** - идентификатор клиента в системе Google Analytics
- **utm_medium** - тип рекламного перехода
- **utm_campaign** - название рекламной кампании из метки
- **utm_term** - ключевая фраза в рекламной кампании
- **utm_content** - метка, содержащая дополнительную информацию
