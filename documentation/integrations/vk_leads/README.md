# Интеграция с VK Leads
________

## Навигация

* [Создание формы VK Leads](#создание-формы-vk-leads)
* [Настройка формы в CallKeeper](#настройка-формы-в-callkeeper)
* [Выбор офиса](#Выбор-офиса)



Что необходимо для интеграции:

- Группа (сообщество) ВКонтакте
- Настроенная форма VK Leads
- Аккаунт на CallKeeper


## Создание формы VK Leads

Перейдите в группу ВКонтакте, которой вы управляете.

![Рис.1](images/vk_group_new.png)

Нажмите на вкладку Управление и выберите раздел Приложения

![Рис.2](images/vk_group_settings_1.png)

Вам нужно установить в сообществе приложение "Форма сбора заявок". 

![Рис.3](images/vk_group_app.png)

Найдите его в списке приложений и нажмите Добавить.

![Рис.4](images/vk_group_app_full.png)

Откройте приложение и нажмите Добавить форму.

![Рис.5](images/vk_group_new_form.png)

Заполните нужную информацию на открывшейся странице.

![Рис.6](images/vk_group_form_questions.png)

Чтобы получать лиды с формы, обязательно выберите поле с Номером Телефона.
Если в виджете, с которым вы планируете связать интеграцию, есть несколько офисов, вы можете добавить альтернативный вопрос с выбором офиса. 

После заполнения всех необходимых полей, назовите форму и нажмите "Сохранить форму".

![Рис.7](images/vk_group_form_name.png)

Созданная форма сохранится в списке форм приложения. Вы можете посмотреть его, кликнув на название приложения в разделе Приложения Настроек группы.

![Рис.8](images/vk_group_form_created.png)

Вы можете отредактировать ее в любой момент, кликнув на название формы.

Обязательно активируйте форму, кликнув на ее статус.

![Рис.9](images/vk_group_form_active.png)

Далее перейдите в Настройках в раздел Работа с API

![Рис.10](images/vk_group_form_api_1.png)

Вам нужен раздел Callback API - Настройки сервера. 
Если в вашей группе уже настраивались интеграции, то добавьте новый сервер, нажав "Добавить сервер".

![Рис.11](images/vk_group_form_api_add_server.png)

Если вы только создали группу, то можно использовать первый сервер, который стоит там по умолчанию.
На этом этапе оставьте строку "Адрес" пустой - к ней нужно будет вернуться позже.

##### Заполните поле "Секретный ключ"
______
#### Примечание:

Секретный ключ должен быть уникальным. Рекомендуется воспользоваться любым сервисом генерации ключей. Обратите внимание, что ключ не должен содержать специальных символов, а длину вы можете определить на свое усмотрение.
______

Кроме секретного ключа вам понадобится **group_id** и **ответ сервера** ("Строка, которую должен вернуть сервер").

![Рис.12](images/vk_group_id.png)
##### group_id 
![Рис.13](images/vk_server_response.png)
##### ответ сервера


Перейдите в раздел Типы событий и поставьте галочку напротив типа "Lead forms: Новая заявка".

![Рис.14](images/vk_group_api_event_type.png)
![Рис.15](images/vk_group_api_type.png)


## Настройка формы в CallKeeper

Перейдите в раздел Сервисы/Вконтакте Leads 

![Рис.16](images/vk_leads_ck.png)

В выпадающем списке выберите "Добавить сообщество" и нажмите кнопку "Добавить форму".

![Рис.16.1](images/vk_leads_main.png)

Если вы уже подключали ранее формы VK Leads, то в выпадающем списке будут варианты сообществ, которые вы уже подключали. В этом случае выберите нужное сообщество и нажмите кнопку "Добавить форму" 

![Рис.16.2](images/vk_leads_groups.png)

В открывшемся меню нужно будет заполнить нужные поля.

![Рис.16.3](images/vk_leads_group_settings.png)

- Название сообщества - название вашей группы (сообщества ВКонтакте)
- Secret сообщества - секретный [ключ сообщества](#заполните-поле-секретный-ключ). 
- ID сообщества - уникальный [идентификатор сообщества](#group_id) 
- Код ответа сервера - [строка, которую должен вернуть сервер](#ответ-сервера)

![Рис.18](images/vk_leads_form_settings.png)

- Название поля с номером телефона - обязательное поле. Укажите здесь поле, которое вы настроили в самой форме VK.

- Вопрос для выбора офиса - точное названия поля, в котором пользователь выбирает офис (берется из созданной формы).

- Шаблон текста, который будет проговариваться оператору - здесь вы можете написать фразу, которая будет проговариваться менеджеру. В шаблоне можно проговорить содержимое полей из формы. Для этого укажите точное название поля в фигурных скобках.

- ID Формы Вконтакте - id вашей формы.

Скопируйте ссылку на созданную форму, которую вы хотите прикрепить, вставьте ссылку в строку браузера (или в любой редактор текста). Последнее значение в строке - form_id=X, где Х - это id формы.

![Рис.20](images/vk_form_check.png)
![Рис.21](images/vk_form_id.png)

![Рис.18.1](images/vk_leads_utm.png)

Вы можете добавить utm-метки. Эти поля необязательны.

После заполнения полей нажмите кнопку "Сохранить".

Все прикрепленные формы будут отображаться в этом же разделе.

![Рис.18.2](images/vk_leads_full.png)

Обратите внимание на колонку "Счетчики". Здесь будет отображаться количество лидов, поступивших на форму, и количество звонков по ним.

Вы можете отредактировать форму или приостановить ее работу, нажав на соответствующие кнопки.

_______

Для завершения интеграции вернитесь в настройки вашей группы Вконтакте.

Раздел Настройки/Работа с API/Callback API/Настройки сервера.

Введите в строку "Адрес" : https://api.callkeeper.ru/vkLead

и нажмите "Подтвердить".


![Рис.26](images/vk_form_server_confirm_ck.png)

Настройка интеграции завершена. Можете разместить готовую форму, скопировав ее ссылку, и заказать звонок.

## Выбор офиса
В случае, если необходимо добавить выпадающий список в форме, важно учесть следующие пункты:
1. Выпадающий список офисов, который создается на стороне VK,  должен в точности совпадать с перечнем офисов в виджете на стороне КоллКипер(порядок расположения, наименование).

2. На стороне КоллКипер, список офисов в виджете должен полностью совпадать с наименованием офиса прописываемым вручную в форме. Блок слева = блоку справа. 

3. Также важно производить настройки форм с выпадающим списком, только по прямому доступу в ЛК КоллКипер. Пользователь, которому выдана роль, не имеет доступа к данной настройке.

![Рис.19](images/virhet_vibor_ofisa11.png)

[Вернуться к оглавлению](#навигация)

[Вернуться на главную](/README.md/#documentation)
