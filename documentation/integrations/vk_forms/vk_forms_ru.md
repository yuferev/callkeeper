
# Интеграция с VK Leads

#### Примечание:
`Инструмент доступен только для аккаунтов, перенесенных с callkeeper.ru/callkeeper.com`
________

## Навигация

* [Создание формы VK Leads](#создание-формы-vk-leads)
* [Настройка формы в Calltracking](#настройка-формы-в-calltracking)
  * [Общие настройки](#общие-настройки)
  * [IVR](#IVR)

Что необходимо для интеграции:

- Группа (сообщество) ВКонтакте
- Настроенная форма VK Leads
- Аккаунт на Calltracking


## Создание формы VK Leads
Перейдите в группу ВКонтакте, которой вы управляете.

![Рис.1](images/vk_group_new.png)

Нажмите на вкладку Управление и выберите раздел Приложения

![Рис.2](images/vk_group_settings_1.png)

Вам нужно установить в сообществе приложение "Форма сбора заявок". 

![Рис.3](images/vk_group_app.png)

Найдите его в списке приложений и нажмите Добавить.

![Рис.4](images/vk_group_app_full.png)

Откройте приложение и нажмите Добавить форму.

![Рис.5](images/vk_group_new_form.png)

Заполните нужную информацию на открывшейся странице.

![Рис.6](images/vk_group_form_questions.png)

Чтобы получать лиды с формы, обязательно выберите поле с Номером Телефона.
Если в виджете, с которым вы планируете связать интеграцию, есть несколько офисов, вы можете добавить альтернативный вопрос с выбором офиса. 

После заполнения всех необходимых полей, назовите форму и нажмите "Сохранить форму".

![Рис.7](images/vk_group_form_name.png)

Созданная форма сохранится в списке форм приложения. Вы можете посмотреть его, кликнув на название приложения в разделе Приложения Настроек группы.

![Рис.8](images/vk_group_form_created.png)

Вы можете отредактировать ее в любой момент, кликнув на название формы.

Обязательно активируйте форму, кликнув на ее статус.

![Рис.9](images/vk_group_form_active.png)

Далее перейдите в Настройках в раздел Работа с API

![Рис.10](images/vk_group_form_api_1.png)

Вам нужен раздел Callback API - Настройки сервера. 
Если в вашей группе уже настраивались интеграции, то добавьте новый сервер, нажав "Добавить сервер".

![Рис.11](images/vk_group_form_api_add_server.png)

Если вы только создали группу, то можно использовать первый сервер, который стоит там по умолчанию.
На этом этапе оставьте строку "Адрес" пустой - к ней нужно будет вернуться позже.

##### Заполните поле "Секретный ключ"
______
#### Примечание:

Секретный ключ должен быть уникальным. Рекомендуется воспользоваться любым сервисом генерации ключей. Обратите внимание, что ключ не должен содержать специальных символов, а длину вы можете определить на свое усмотрение.
______

Кроме секретного ключа вам понадобится **group_id** и **ответ сервера** ("Строка, которую должен вернуть сервер").

![Рис.12](images/vk_group_id.png)
##### group_id 
![Рис.13](images/vk_server_response.png)
##### ответ сервера


Перейдите в раздел Типы событий и поставьте галочку напротив типа "Lead forms: Новая заявка".

![Рис.14](images/vk_group_api_event_type.png)
![Рис.15](images/vk_group_api_type.png)



## Настройка формы в Calltracking

Перейдите в раздел Социальные сети во вкладку VK Forms.

![Рис.16](images/socials_vk_new.png)

Нажмите кнопку "+ Подключить группу"

Заполните поля в новом окне и нажмите "Добавить".

![Рис.17](images/vk_form_full.png)

- Название сообщества - название вашей группы (сообщества ВКонтакте)
- Secret сообщества - секретный [ключ сообщества](#заполните-поле-секретный-ключ). 
- ID сообщества - уникальный [идентификатор сообщества](#group_id) 
- Код ответа сервера - [строка, которую должен вернуть сервер](#ответ-сервера)

![Рис.18](images/socials_vk_added.png)

Добавленная группа отобразится на этой же странице.

Нажмите "+ Добавить новую форму", чтобы прикрепить созданную форму VK Leads.
_______
### Общие настройки

![Рис.19](images/vk_form_new.png)

Заполните название формы и прикрепите к ней виджет.

Если у вас еще нет виджета, вы можете закончить настройки формы VK Leads, сохранить еe и перейти к [созданию виджета](/documentation/apps/widget/widget_ru.md). Не забудьте позже вернуться в настройки формы VK Leads и привязать еt. Без привязки к виджету формы VK Leads не будет работать.

- Название поля с номером телефона - точное название поля, в котором пользователь будет набирать свой номер (берется из созданной формы).
- ID Формы Вконтакте - id вашей формы.

Скопируйте ссылку на созданную форму, которую вы хотите прикрепить, вставьте ссылку в строку браузера (или в любой редактор текста). Последнее значение в строке - form_id=X, где Х - это id формы.

![Рис.20](images/vk_form_check.png)
![Рис.21](images/vk_form_id.png)

- Вопрос для выбора офиса - точное названия поля, в котором пользователь выбирает офис (берется из созданной формы).

После добавления Вопроса для выбора офиса вы можете добавить офисы виджета, которые будут соответствовать выбранным значениям в форме.

![Рис.22](images/vk_form_offices.png)

Нажмите "+ Добавить офис", в левом поле введите значение, выбранное вами в форме, в правом - выберите офис, которому будет соответствовать это значение.
Добавьте столько офисов, сколько вариантов вы добавили в форме.


![Рис.23](images/vk_form_settings_2.png)

Вы можете добавить добавить utm-метки. Эти поля опциональны.
_______
### IVR 

На вкладке IVR вы можете отредактировать текст, который услышит менеджер при звонке с этой формы VK Lead.

Если у вас включен сервис SmartCall, то у вас будет возможность настроить два шаблона проговариваемого текста - до и после нажатия/проговаривание цифры для инициации звонка.

![Рис.24](images/vk_form_ivr.png)

После завершения настроек нажмите кнопку "Добавить".

![Рис.25](images/socials_vk_full.png)

Добавленная форма будет отображаться на вкладке VK Forms.

Убедитесь, что ползунок напротив формы сдвинут вправо - в активное положение.


_______

Вернитесь в настройки вашей группы Вконтакте.

Раздел Настройки/Работа с API/Callback API/Настройки сервера.

Введите в строку "Адрес" :

и нажмите "Подтвердить".


![Рис.26](images/vk_form_server_confirm.png)

Настройка интеграции завершена. Можете разместить готовую форму, скопировав ее ссылку, и заказать звонок.

[Вернуться к оглавлению](#)

[Вернуться на главную](/README.md/#documentation)





